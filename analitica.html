<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Asistente Clínico – Análisis Difuso</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>

<style>
  :root {
    --fondo: #f2efe9;
    --card: #ffffff;
    --texto: #2e2e2e;
    --acento: #c08457;
    --acento-hover: #a5673f;
    --sombra: rgba(0, 0, 0, 0.1);
  }

  body {
    font-family: 'Poppins', sans-serif;
    background: var(--fondo);
    color: var(--texto);
    margin: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  header {
    background: var(--card);
    padding: 25px 40px;
    box-shadow: 0 2px 10px var(--sombra);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  header h1 { font-size: 1.3rem; font-weight: 600; }

  main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 20px;
  }

  .upload-box {
    width: 100%;
    max-width: 700px;
    background: var(--card);
    border-radius: 16px;
    box-shadow: 0 4px 12px var(--sombra);
    padding: 30px;
    margin-top: 20px;
  }

  h2 { color: var(--acento); margin-bottom: 10px; }

  input, button {
    font-family: inherit;
    border-radius: 8px;
    border: 1px solid #ccc;
    padding: 10px;
  }

  button {
    background: var(--acento);
    color: white;
    border: none;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.25s;
  }

  button:hover { background: var(--acento-hover); }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
    margin-top: 20px;
  }

  .results {
    margin-top: 30px;
    background: #fffaf3;
    border-radius: 10px;
    padding: 20px;
    border-left: 5px solid var(--acento);
  }

  .result-item {
    margin-bottom: 12px;
    line-height: 1.4;
  }

  footer {
    background: var(--card);
    text-align: center;
    padding: 15px;
    color: #777;
    font-size: 0.9em;
    box-shadow: 0 -2px 6px var(--sombra);
  }

  .floating-chat {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--acento);
    border-radius: 50%;
    width: 54px;
    height: 54px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    cursor: pointer;
  }

  .floating-chat:hover { background: var(--acento-hover); }
</style>
</head>

<body>
  <header>
    <h1>Asistente Clínico Inteligente</h1>
    <button onclick="window.location.href='index.html'" class="back-btn">Volver al inicio</button>
  </header>

  <main>
    <div class="upload-box">
      <h2>Evaluación Difusa de Analítica</h2>
      <p>Puedes subir un archivo o introducir los valores manualmente. El sistema aplicará reglas de lógica difusa reales y estimará probabilidades de patologías comunes.</p>

      <div style="margin-top:20px;">
        <label for="fileInput">Subir PDF (opcional):</label>
        <input type="file" id="fileInput" accept=".pdf" onchange="mockExtract()" />
      </div>

      <h3 style="margin-top:30px;">Valores manuales</h3>
      <div class="form-grid" id="formGrid">
        <input type="number" id="glucosa" placeholder="Glucosa (mg/dL)">
        <input type="number" id="colesterol" placeholder="Colesterol total (mg/dL)">
        <input type="number" id="ldl" placeholder="LDL (mg/dL)">
        <input type="number" id="hdl" placeholder="HDL (mg/dL)">
        <input type="number" id="trigliceridos" placeholder="Triglicéridos (mg/dL)">
        <input type="number" id="tsh" placeholder="TSH (uUI/mL)">
        <input type="number" id="t4" placeholder="T4 libre (ng/dL)">
        <input type="number" id="alt" placeholder="GPT / ALT (U/L)">
        <input type="number" id="ast" placeholder="GOT / AST (U/L)">
      </div>

      <button style="margin-top:25px;" onclick="analizar()">Analizar resultados</button>

      <div class="results" id="resultados" style="display:none;"></div>
    </div>
  </main>

  <footer>© 2025 Asistente Clínico Inteligente — Evaluación Difusa</footer>

  <div class="floating-chat" title="Abrir chat con el asistente">
    <i data-lucide="message-circle"></i>
  </div>

<script>
  lucide.createIcons();

  function mockExtract() {
    alert("Lectura del PDF aún no implementada. Puedes usar los campos manuales para evaluar la lógica difusa.");
  }

  async function analizar() {
    const div = document.getElementById('resultados');
    div.style.display = "block";
    div.innerHTML = "<p>Analizando con lógica difusa...</p>";

    try {
      const response = await fetch("https://pilarmas-logicadifusadedalus.hf.space/fuzzy", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          glucosa: parseFloat(document.getElementById("glucosa").value) || 0,
          colesterol: parseFloat(document.getElementById("colesterol").value) || 0,
          tsh: parseFloat(document.getElementById("tsh").value) || 0,
          t4: parseFloat(document.getElementById("t4").value) || 0,
          alt: parseFloat(document.getElementById("alt").value) || 0,
          ast: parseFloat(document.getElementById("ast").value) || 0
        })
      });

      if (!response.ok) throw new Error("Servidor no responde");

      const data = await response.json();

      if (data.error) {
        div.innerHTML = `<p style='color:red;'>⚠️ Error del modelo: ${data.error}</p>`;
        return;
      }

      div.innerHTML = "<h3>Resultados de evaluación difusa:</h3>";
      for (const [clave, valor] of Object.entries(data)) {
        div.innerHTML += `<div class='result-item'><strong>${clave}:</strong> ${valor}%</div>`;
      }

    } catch (error) {
      console.error(error);
      div.innerHTML = `<p style='color:red;'>❌ Error al conectar con el servidor: ${error.message}</p>`;
    }
  }
</script>

</body>
</html>
